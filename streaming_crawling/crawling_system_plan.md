
# ğŸ¯ í¬ë¡¤ë§ ì‹œìŠ¤í…œ ê¸°íšì„œ (FK ì—†ìŒ, Enum í”Œë«í¼, Redis/Celery ë¯¸ì‚¬ìš©)

---

## ğŸ“Œ 1. ê°œìš”

ë³¸ ì‹œìŠ¤í…œì€ Melon, Genie, YouTube, YouTube Music ë“± ë‹¤ì–‘í•œ ìŒì•… í”Œë«í¼ì—ì„œ ë…¸ë˜ ê´€ë ¨ ë°ì´í„°ë¥¼ ìˆ˜ì§‘í•˜ì—¬ ì €ì¥í•˜ëŠ” **ì •ê¸° + íŠ¸ë¦¬ê±° ê¸°ë°˜ í¬ë¡¤ë§ ì‹œìŠ¤í…œ**ì…ë‹ˆë‹¤.  
Celeryë‚˜ Redis ê°™ì€ ë©”ì‹œì§€ ë¸Œë¡œì»¤ ì—†ì´ êµ¬í˜„ë˜ë©°, í”Œë«í¼ ê°„ ì¼ê´€ëœ ë°ì´í„°ë¥¼ ì œê³µí•˜ëŠ” ê²ƒì´ ëª©í‘œì…ë‹ˆë‹¤.

---

## ğŸ—‚ï¸ 2. í…Œì´ë¸” êµ¬ì¡°

### âœ… Enum ì •ì˜ (platform)

~~~~dbml
Enum PlatformType {
  melon
  genie
  youtube
  youtube_music
}
~~~~

---

### âœ… song_info

| í•„ë“œëª…        | íƒ€ì…       | ì„¤ëª…                         |
|---------------|------------|------------------------------|
| id            | char(32)   | UUID (PK), FK ì—†ìŒ           |
| title         | varchar    | ê³¡ ì œëª©                      |
| artist        | varchar    | ì•„í‹°ìŠ¤íŠ¸ëª…                   |
| youtube_url   | varchar    | ìœ íŠœë¸Œ ì˜ìƒ ë§í¬             |
| melon_song_id | varchar    | ë©œë¡  ê³¡ ID (API ë¶„ì„ìš©)      |
| createdAt     | datetime   | ìƒì„±ì¼                       |
| updatedAt     | datetime   | ìˆ˜ì •ì¼                       |

---

### âœ… crawling_period

| í•„ë“œëª…     | íƒ€ì…       | ì„¤ëª…                         |
|------------|------------|------------------------------|
| id         | char(32)   | UUID (PK)                    |
| song_id    | char(32)   | song_info.id ì°¸ì¡° (FK ì—†ìŒ)  |
| start_date | date       | í¬ë¡¤ë§ ì‹œì‘ì¼                |
| end_date   | date       | í¬ë¡¤ë§ ì¢…ë£Œì¼                |
| isActive   | boolean    | í˜„ì¬ ìœ íš¨í•œì§€ ì—¬ë¶€           |
| createdAt  | datetime   | ìƒì„±ì¼                       |
| updatedAt  | datetime   | ìˆ˜ì •ì¼                       |

---

### âœ… crawling_data

| í•„ë“œëª…     | íƒ€ì…         | ì„¤ëª…                                |
|------------|--------------|-------------------------------------|
| id         | char(32)     | UUID (PK)                           |
| song_id    | char(32)     | song_info.id ì°¸ì¡° (FK ì—†ìŒ)         |
| views      | bigint       | ì¡°íšŒìˆ˜                               |
| listeners  | bigint       | ì²­ì·¨ì ìˆ˜ (ì—†ì„ ê²½ìš° -1 ë˜ëŠ” -999)  |
| platform   | PlatformType | melon, genie, youtube ë“± (enum)     |
| createdAt  | datetime     | ìˆ˜ì§‘ ì‹œì                            |
| updatedAt  | datetime     | ìˆ˜ì • ì‹œì                            |

---

## ğŸ§  3. í¬ë¡¤ë§ ë°©ì‹

### ğŸ“Œ (1) ì •ê¸° í¬ë¡¤ë§

- **ì‹œê°„:** ë§¤ì¼ ìƒˆë²½ 3ì‹œ
- **ëŒ€ìƒ:** crawling_period.isActive = true AND ì˜¤ëŠ˜ì´ start_date ~ end_date ì‚¬ì´ì¸ ê³¡
- **ë°©ì‹:** Django management command + cron
- **íë¦„:**
  1. ìœ íš¨í•œ ê³¡ í•„í„°ë§
  2. ê° í”Œë«í¼ë³„ í¬ë¡¤ë§
  3. crawling_dataì— ì €ì¥

---

### ğŸ“Œ (2) ì‹ ê·œ ë“±ë¡ í¬ë¡¤ë§

- **ì‹œì :** ê³¡ ë“±ë¡ í›„ ì¦‰ì‹œ
- **ëª©ì :** í¬ë¡¤ë§ ê°€ëŠ¥ ì—¬ë¶€ í™•ì¸ ë° í…ŒìŠ¤íŠ¸
- **íë¦„:**
  1. song_info + crawling_period ìƒì„±
  2. ë“±ë¡ ì¦‰ì‹œ 1íšŒ í¬ë¡¤ë§ ìˆ˜í–‰
  3. crawling_data ì €ì¥

---

## ğŸ” 4. ë°ì´í„° ì²˜ë¦¬ ì •ì±…

### ğŸ“‹ í”Œë«í¼ë³„ ì§€ì› í•­ëª©

| í”Œë«í¼        | ì¡°íšŒìˆ˜(views) | ì²­ì·¨ì ìˆ˜(listeners) |
|---------------|---------------|------------------------|
| Melon         | âœ… ì§€ì›       | âœ… ì§€ì›                |
| Genie         | âœ… ì§€ì›       | âœ… ì§€ì›                |
| YouTube       | âœ… ì§€ì›       | âŒ ë¯¸ì§€ì›              |
| YouTube Music | âœ… (ì˜ˆì •)     | âŒ ë¯¸ì§€ì›              |

---

### ğŸš¨ í•„ë“œ ì˜ˆì™¸ ì²˜ë¦¬ ê¸°ì¤€

| ìƒí™©                    | ê°’     | ì„¤ëª…                              |
|-------------------------|--------|-----------------------------------|
| ì •ìƒ ìˆ˜ì§‘               | ì •ìˆ˜   | ex. 123456                        |
| í•´ë‹¹ í”Œë«í¼ ë¯¸ì§€ì›      | `-1`   | ex. YouTubeì˜ listeners           |
| í¬ë¡¤ë§ ì‹¤íŒ¨ / ì˜ˆì™¸ ë°œìƒ | `-999` | ì‘ë‹µ ì—†ìŒ, ì˜¤ë¥˜ ë°œìƒ ë“±          |

- `nullable = false`, ê¸°ë³¸ê°’ ì„¤ì •ì„ í†µí•´ NULL ë°©ì§€

---

## ğŸ› ï¸ 5. ê¸°ìˆ  ìŠ¤íƒ ë° êµ¬í˜„ ìš”ì†Œ

- **Backend:** Django
- **í¬ë¡¤ë§ ë„êµ¬:** Selenium, BeautifulSoup
- **DB:** MySQL (UUID â†’ char(32))
- **ìŠ¤ì¼€ì¤„ë§:** cron + `python manage.py run_crawling_job`
- **ì €ì¥:** crawling_data (DB), í•„ìš” ì‹œ CSVë¡œ ë³‘ë ¬ ì €ì¥
