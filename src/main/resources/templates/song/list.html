<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>UNEARTH | ìŒì› ë“±ë¡</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/css/base.css">
    <link rel="stylesheet" href="/css/song.css">
</head>
<body>
<div th:replace="~{common/header :: header}"></div>
<div class="main-container">
    <div th:replace="~{common/sidebar :: sidebar(activeMenu='songRegister')}"></div>
    <section class="content">
        <h2>ìŒì› ë“±ë¡</h2>
        <form id="songRegisterForm" class="register-form" method="post" th:action="@{/song/register}">
            <div class="song-form-grid">
                <div class="form-row"><label>ì•„í‹°ìŠ¤íŠ¸ëª…(êµ­ë¬¸) <span class="required-star">*</span></label><input type="text" name="artistKo" required /></div>
                <div class="form-row"><label>ì•¨ë²”ëª…(êµ­ë¬¸) <span class="required-star">*</span></label><input type="text" name="albumKo" required /></div>
                <div class="form-row"><label>íŠ¸ë™ëª…(êµ­ë¬¸) <span class="required-star">*</span></label><input type="text" name="titleKo" required /></div>
                <div class="form-row"><label>songId(ë©œë¡ ) <span class="required-star">*</span></label><input type="text" name="melonSongId" required /></div>
                <div class="form-row"><label>ì•„í‹°ìŠ¤íŠ¸ëª…(ì˜ë¬¸) <span class="required-star">*</span></label><input type="text" name="artistEn" required /></div>
                <div class="form-row"><label>ì•¨ë²”ëª…(ì˜ë¬¸) <span class="required-star">*</span></label><input type="text" name="albumEn" required /></div>
                <div class="form-row"><label>íŠ¸ë™ëª…(ì˜ë¬¸) <span class="required-star">*</span></label><input type="text" name="titleEn" required /></div>
                <div class="form-row"><label>ìœ íŠœë¸Œ ê³µì‹ URL <span class="required-star">*</span></label><input type="text" name="youtubeUrl" required /></div>
                <div class="form-row">
                    <label>ê¶Œë¦¬ìëª… <span class="required-star">*</span></label>
                    <select name="rightHolderName" required>
                        <option value="">ê¶Œë¦¬ìë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                        <option th:each="holder : ${rightHolders}" th:value="${holder}" th:text="${holder}"></option>
                    </select>
                </div>
            </div>
            <div class="form-row">
                <button type="submit" class="register-btn" id="songRegisterBtn" disabled>ìŒì› ë“±ë¡í•˜ê¸°</button>
            </div>
        </form>
        <form class="search-form" method="get" th:action="@{/song/list}">
            <div class="search-row">
                <div class="search-group"><label>ê²€ìƒ‰</label><input type="text" name="search" class="search-input" th:value="${search}" placeholder="ê²€ìƒ‰ì–´ ì…ë ¥" /></div>
                <div class="search-group search-btn-group"><button type="submit" class="search-btn">ê²€ìƒ‰</button></div>
            </div>
        </form>
        <table class="holder-table song-table">
            <thead>
            <tr>
                <th>ì•„í‹°ìŠ¤íŠ¸ëª…(êµ­ë¬¸)</th><th>ì•¨ë²”ëª…(êµ­ë¬¸)</th><th>íŠ¸ë™ëª…(êµ­ë¬¸)</th><th>ìœ íŠœë¸Œ ê³µì‹ URL</th><th>ê¶Œë¦¬ìëª…</th><th>í¬ë¡¤ë§ ì‹¤í–‰</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="song : ${response.data.content}">
                <td th:text="${song.artistKo}"></td>
                <td th:text="${song.albumKo}"></td>
                <td th:text="${song.titleKo}"></td>
                <td><a th:href="${song.youtubeUrl}" target="_blank" class="ellipsis" th:text="${song.youtubeUrl}"></a></td>
                <td th:text="${song.rightHolder.holderName}"></td>
                <td class="crawling-column">
                    <button type="button" class="crawling-btn">ğŸ•¹ï¸</button>
                    <span class="crawling-period" th:if="${song.crawlingStartDate != null and song.crawlingEndDate != null}" 
                          th:text="${#temporals.format(song.crawlingStartDate, 'yy.MM.dd')} + ' ~ ' + ${#temporals.format(song.crawlingEndDate, 'yy.MM.dd')}"></span>
                    <span class="crawling-period empty" th:if="${song.crawlingStartDate == null or song.crawlingEndDate == null}">-</span>
                </td>
            </tr>
            <tr th:if="${response.data.content.size() == 0}"><td colspan="6" style="text-align:center;">ìŒì›ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>
            </tbody>
        </table>
        <div class="pagination" th:if="${response.data.totalPages > 0}">
            <a th:if="${response.data.hasPrevious()}" th:href="@{/song/list(page=${response.data.number - 1}, size=${size}, search=${search})}" class="page-btn">ì´ì „</a>
            <span th:each="i : ${#numbers.sequence(0, response.data.totalPages - 1)}">
                <a th:if="${i != response.data.number}" th:href="@{/song/list(page=${i}, size=${size}, search=${search})}" th:text="${i + 1}" class="page-btn"></a>
                <span th:if="${i == response.data.number}" th:text="${i + 1}" class="page-btn current"></span>
            </span>
            <a th:if="${response.data.hasNext()}" th:href="@{/song/list(page=${response.data.number + 1}, size=${size}, search=${search})}" class="page-btn">ë‹¤ìŒ</a>
        </div>
    </section>
</div>
<script>
// í¼ ìœ íš¨ì„± ê²€ì‚¬ ë° ë²„íŠ¼ í™œì„±í™”
const form = document.getElementById('songRegisterForm');
const btn = document.getElementById('songRegisterBtn');
function validateForm() {
    let valid = true;
    ['artistKo','artistEn','albumKo','albumEn','titleKo','titleEn','youtubeUrl','melonSongId','rightHolderName'].forEach(name => {
        const el = form.elements[name];
        if (!el || !el.value || el.value.trim() === '') valid = false;
    });
    btn.disabled = !valid;
}
form && form.addEventListener('input', validateForm);
form && form.addEventListener('change', validateForm);
form && form.addEventListener('submit', function(e) {
    if (btn.disabled) { e.preventDefault(); return false; }
    if (!confirm('ìŒì›ì„ ë“±ë¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) { e.preventDefault(); return false; }
});
</script>
</body>
</html> 